<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>CoreBoard â€” Sign in</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .auth-wrap{max-width:520px;margin:60px auto;padding:0 20px}
    .auth-card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:18px}
    .tabs{display:flex;background:#1b1b1f;border:1px solid var(--line);border-radius:999px;gap:6px;padding:4px;margin-bottom:14px}
    .tabs button{background:transparent;border:0;color:var(--muted);padding:8px 12px;border-radius:999px;cursor:pointer}
    .tabs button.active{background:var(--panel-2);color:#fff}
    .hint{color:var(--muted);font-size:13px;margin-top:8px}
    .row{display:flex;gap:10px;align-items:center}
    .center{text-align:center}
    .tiny{font-size:12px;color:var(--muted)}
    .badge-plan{display:inline-block;margin-left:8px;font-size:12px;background:#1b1b1e;border:1px solid var(--line);color:var(--muted);padding:2px 8px;border-radius:999px}
    .spin{display:inline-block;width:16px;height:16px;border:2px solid #fff;border-right-color:transparent;border-radius:50%;vertical-align:-3px;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- Nav -->
  <nav class="nav">
    <div class="container inner">
      <a class="brand" href="index.html"><span class="logo"></span><span>CoreBoard</span></a>
      <div style="display:flex;gap:10px">
        <a href="features.html" class="btn ghost">Features</a>
        <a href="pricing.html" class="btn ghost">Pricing</a>
        <a href="login.html" class="btn">Sign in</a>
      </div>
    </div>
  </nav>

  <div class="auth-wrap">
    <div class="auth-card">
      <div class="center" style="margin-bottom:10px">
        <h1 style="margin:0;font-size:22px" id="title">Sign in</h1>
        <div class="tiny" id="subtitle">Use your email and password.</div>
        <span class="badge-plan" id="planBadge" style="display:none"></span>
      </div>

      <!-- tabs -->
      <div class="tabs center" role="tablist" aria-label="Auth mode">
        <button id="tabSignin" class="active" role="tab" aria-selected="true">Sign in</button>
        <button id="tabSignup" role="tab" aria-selected="false">Create account</button>
      </div>

      <!-- form -->
      <div class="row" style="margin-bottom:10px;flex-direction:column;align-items:stretch">
        <input id="email" class="input" placeholder="you@example.com" autocomplete="email"/>
        <input id="password" class="input" type="password" placeholder="Password (6+ chars)" style="margin-top:8px"/>
        <div class="tiny" style="margin-top:6px" id="tip">
          Enter your password to continue.
        </div>
      </div>

      <button id="submit" class="btn" style="width:100%">Continue</button>
      <div id="msg" class="hint"></div>

      <div class="hint center" style="margin-top:14px">
        Already signed in? <a href="dashboard.html" style="color:var(--accent)">Go to dashboard â†’</a>
      </div>

      <div class="hint center" style="margin-top:8px">
        <a id="forgot" href="#" style="color:var(--accent)">Forgot your password?</a>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container" style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap">
      <div>Â© CoreBoard</div>
      <div style="display:flex;gap:16px">
        <a href="index.html">Home</a>
        <a href="features.html">Features</a>
        <a href="pricing.html">Pricing</a>
        <a href="#">Privacy</a>
        <a href="#">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Password-only auth (no magic links) -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

    // ðŸ”§ Set these from Supabase â†’ Settings â†’ API
    const SUPABASE_URL  = 'https://xcsbogfddhvbyscjkjsi.supabase.co'
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhjc2JvZ2ZkZGh2YnlzY2pranNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNzUzMjksImV4cCI6MjA3MDg1MTMyOX0.HGX4G2zw0F_EwMRuYOx3SMnP9qxurLHiYBUOe-9FEVk'
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON)

    // Elements
    const $ = (s)=>document.querySelector(s)
    const title = $('#title')
    const subtitle = $('#subtitle')
    const planBadge = $('#planBadge')
    const email = $('#email')
    const password = $('#password')
    const submit = $('#submit')
    const msg = $('#msg')
    const tabSignin = $('#tabSignin')
    const tabSignup = $('#tabSignup')
    const tip = $('#tip')
    const forgot = $('#forgot')

    // Mode & plan from URL (?mode=signup&plan=pro)
    const params = new URLSearchParams(location.search)
    let mode = (params.get('mode') || 'signin').toLowerCase() // 'signin' | 'signup'
    const plan = (params.get('plan') || '').toLowerCase()     // 'free' | 'pro' | ''
    if (plan) { planBadge.style.display='inline-block'; planBadge.textContent = plan === 'pro' ? 'Pro plan' : 'Free plan' }

    function setMode(next){
      mode = next
      tabSignin.classList.toggle('active', mode==='signin')
      tabSignup.classList.toggle('active', mode==='signup')
      tabSignin.setAttribute('aria-selected', String(mode==='signin'))
      tabSignup.setAttribute('aria-selected', String(mode==='signup'))
      title.textContent = mode==='signin' ? 'Sign in' : 'Create account'
      subtitle.textContent = 'Use your email and password.'
      tip.textContent = mode==='signin' ? 'Enter your password to continue.' : 'Choose a password (6+ chars) to create your account.'
      submit.textContent = mode==='signin' ? 'Continue' : 'Create account'
      msg.textContent = ''
      const u = new URL(location.href)
      u.searchParams.set('mode', mode)
      if (plan) u.searchParams.set('plan', plan)
      history.replaceState({}, '', u)
    }
    setMode(mode)
    tabSignin.onclick = ()=> setMode('signin')
    tabSignup.onclick = ()=> setMode('signup')

    function setLoading(on){
      submit.disabled = on
      submit.innerHTML = on ? '<span class="spin"></span> Workingâ€¦' : (mode==='signin' ? 'Continue' : 'Create account')
    }
    const showMsg = (t)=> { msg.textContent = t }

    // Password-only flow:
    // SIGNUP â†’ signUp(email,password) â†’ signInWithPassword â†’ redirect to plans.html
    // SIGNIN â†’ signInWithPassword â†’ redirect to dashboard.html
    submit.onclick = async ()=>{
      const em = (email.value || '').trim()
      const pw = (password.value || '').trim()
      if (!em) return showMsg('Enter your email.')
      if (!pw || pw.length < 6) return showMsg('Enter your password (6+ chars).')

      setLoading(true)
      try {
        if (mode === 'signup') {
          const { error: upErr } = await supabase.auth.signUp({
            email: em,
            password: pw,
            options: {
              // If you ever enable confirmations later, this is the post-confirm redirect:
              emailRedirectTo: location.origin + '/dashboard.html',
              data: { plan: plan || 'free', source: 'coreboard-signup' }
            }
          })
          if (upErr) { showMsg(upErr.message); setLoading(false); return }

          // Immediate sign-in (with confirmations OFF this will succeed right away)
          const { error: inErr } = await supabase.auth.signInWithPassword({ email: em, password: pw })
          if (inErr) { showMsg(inErr.message); setLoading(false); return }

          location.href = 'plans.html'
          return
        } else {
          const { error } = await supabase.auth.signInWithPassword({ email: em, password: pw })
          if (error) {
            showMsg(/invalid login credentials/i.test(error.message) ? 'Invalid email or password.' : error.message)
          } else {
            location.href = 'dashboard.html'
          }
        }
      } catch (e) {
        console.error(e)
        showMsg('Failed to reach Supabase. Check Site URL & Redirect URLs.')
      } finally {
        setLoading(false)
      }
    }

    // Optional: password reset (uses email; delete this block if you truly want no emails at all)
    forgot.onclick = async (e)=>{
      e.preventDefault()
      const em = (email.value || '').trim()
      if (!em) return showMsg('Enter your email first.')
      const { error } = await supabase.auth.resetPasswordForEmail(em, {
        redirectTo: location.origin + '/reset.html'
      })
      showMsg(error ? error.message : 'If this email exists, a reset link was sent.')
    }

    // Already logged in? bounce to dashboard
    ;(async ()=>{
      try {
        const { data:{ session } } = await supabase.auth.getSession()
        if (session) location.href = 'dashboard.html'
      } catch (e) { console.warn('Session check failed:', e) }
    })()
  </script>
</body>
</html>
